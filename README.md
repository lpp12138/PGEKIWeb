# PGEKI HID Controller

这是一个基于 **WebHID** 的设备配置工具，PGEKI2提供一个简单直观的配置界面。
用户可以通过此网页修改按键的RGB灯光颜色和键码，并将配置实时发送到设备。

## ✨ 功能特性

- **按键配置**: 可视化配置每个按键的RGB颜色和USB HID键码。
- **多配置文件**: 支持6个独立的配置文件，可随时切换。
- **可伸缩侧边栏**: 常用工具（如重置灯光/按键）被收纳在左侧的可伸缩侧边栏中，让界面更整洁。
- **多种键型**: 除了8个主要按键外，下方还有一行包含2个可配置和1个装饰性的小圆形按键。
- **实时更新**: 通过 **WebHID API**，配置更改可以立即发送到连接的设备。
- **本地存储**: 所有配置都保存在浏览器的LocalStorage中，刷新页面不会丢失。
- **IO模式**: 第一个配置文件为特殊的"IO模式"，仅允许修改灯光，键码不可配置。此模式下，可以通过侧边栏的开关选择是否由本程序接管设备的IO指示灯，且下方的小按键完全禁用。
- **灯光/按键重置**: 提供一键重置当前配置文件所有按键灯光或键位的功能。

## 🚀 如何使用

1.  **连接设备**: 将您的PGEKI2连接到电脑。
2.  **打开网页**: 使用支持 **WebHID** 的现代浏览器（如最新版的Chrome、Edge）打开 `index.html` 文件。
3.  **授权连接**: 点击页面右上角的"连接设备喵"按钮，在浏览器弹出的授权窗口中选择您的设备并点击"连接"。连接成功后，此按钮会变为"写入单个配置文件"。
4.  **开始配置**:
    -   点击左上角的数字切换不同的配置文件。
    -   点击键盘布局上的任意按键，在弹出的窗口中修改颜色和键码，然后点击"保存喵"。此操作仅在网页上生效。
    -   点击左侧侧边栏的按钮，可以重置当前配置文件的所有颜色或键位设置。此操作也仅在网页上生效。
    -   当处于**配置文件1**时，侧边栏会出现"接管IO灯光"开关。打开它，意味着您希望通过本程序来控制灯光；关闭它，则设备可以恢复其自身的IO指示灯逻辑。
5.  **写入配置**: 当您完成一个配置文件的修改后，点击"写入单个配置文件"按钮，即可将当前网页上的配置数据一次性发送到您的设备中。
6.  **保存与载入**:
    -   点击"保存配置喵"，可以将全部6个配置文件的设置保存为一个.json文件到您的电脑中。
    -   点击"载入配置喵"，可以选择之前保存的.json文件，将其中的配置恢复到网页上。

## 📦 HID 通信协议

上位机（此网页）通过 **WebHID API** 向设备发送一个63字节的数据包。通信的唯一入口是"写入单个配置文件"按钮。

### 命令: 写入完整配置文件 (`0x10`)

此命令用于将一个完整的配置文件（包含所有8个按键的颜色和键码）一次性发送给设备。

| 字节位置   | 描述                 | 值范围                | 备注                                           |
| :--------- | :------------------- | :-------------------- | :--------------------------------------------- |
| **Report ID** | -                   | `0`                   | 使用默认的Report ID `0` 来发送数据包。         |
| `0`        | **命令ID**           | `0x10`                | 固定值，表示"写入完整配置文件"                 |
| `1`        | **配置文件ID**       | `0` - `5`             | 对应界面上的配置文件1-6                        |
| `2` - `41` | **10个按键数据**     | `0`-`255` (各字节)    | 每个按键占4字节(R,G,B,码)，共40字节。         |
| `42`       | **IO灯光接管标志**   | `0` 或 `1`            | 仅在`配置文件ID`为`0`时有效。`1`表示接管，`0`表示不接管。 |
| `43` - `62`| **保留字段**         | `0`                   | 填充为0                                        |

**注意**:
- **包大小为63字节**。
- 每个按键的数据块为4个字节，顺序为：`Red`, `Green`, `Blue`, `KeyCode`。
- 按键顺序为界面上从左到右，从上到下，ID `0` 到 `9`。
- 对于ID为 `8`-`9` 的小按键，其RGB值应被设备忽略（上位机将发送 `0,0,0`）。
- 在**配置文件1**（IO模式）下，设备应忽略所有按键的 `KeyCode` 字节，并忽略对ID为 `8`-`9` 小按键的任何操作。
- 如果某个按键未在网页上配置，其对应的颜色值默认为`#7f8c8d` (127, 140, 141)，键码为 `0x00`。